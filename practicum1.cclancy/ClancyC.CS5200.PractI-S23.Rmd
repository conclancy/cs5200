---
title: 'Practicum I - Bird Strike Database'
author: 
- 'Connor Clancy'
date: 'Spring 2023'
---

## Connect to Database
```{r database_connection}
library(RMySQL)

db_user <- 'admin'
db_password <- 'Northea$tern23'
db_name <- 'practicumOne'
db_host <- 'cclancy-cs5200.cbowkysg1oyc.us-east-2.rds.amazonaws.com'
db_port <- 3306

dbcon <- dbConnect(MySQL(), user = db_user, password = db_password,
                   dbname = db_name, host = db_host, port = db_port)
```

## Create Database (Task 4)

### 4A - Incidents
```{sql dropTableIncidents, connection=dbcon}
DROP TABLE IF EXISTS incidents;
```

```{sql createTableIncidents, connection=dbcon}
CREATE TABLE incidents (
  rid INT PRIMARY KEY,
  `dep.date` DATE,
  origin INT,
  airline INT, 
  aircraft VARCHAR(255) NOT NULL,
  `flight.phase` ENUM('takeoff', 'landing', 'inflight', 'unknown'),
  altitude INT,
  conditions INT, 
  warned TINYINT,
  CHECK(altitude>=0)
);
```

### 4B - Airports
```{sql dropTableAirports, connection=dbcon}
DROP TABLE IF EXISTS airports;
```

```{sql createTableAirports, connection=dbcon}
CREATE TABLE airports(
  aid INT AUTO_INCREMENT PRIMARY KEY,
  airportName VARCHAR(255) NOT NULL,
  airportCode VARCHAR(3),
  state VARCHAR(255)
)
```

### 4C - Foreign Key Incident Airports 
```{r dropFKIncidentsAirports}
# Query the database for the foreign key
iac <- dbGetQuery(dbcon, 
  "SELECT TRUE
  FROM information_schema.table_constraints
  WHERE constraint_name = 'FK_IncidentAirports';"
  )

# If the foreign key exist, delete it
if (nrow(iac) > 0) {
  dbExecute(dbcon, "ALTER TABLE incidents DROP FOREIGN KEY FK_IncidentAirports;")
}
```

```{sql connection=dbcon}
ALTER TABLE incidents
ADD CONSTRAINT FK_IncidentAirports 
FOREIGN KEY (origin) REFERENCES airports(aid);
```

### 4D - Conditions 

### 4E - Airlines

### 4F - Join Incidents Airlines 

### 4G - Test Code to ensure the tables are properly set up 

## Load Data (Task 6)

## Show Table Heads (Task 7)

## States with the most bird strikes (Task 8)

## Airlines with above average bird strikes (Task 9)

## Birdstrikes by month and fligth phase (Task 10)

## Birdstrike Scatter Plot (Task 11)

## Stored Procedure for adding an incident to the database (Task 12)

